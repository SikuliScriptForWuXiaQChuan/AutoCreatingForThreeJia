
<html>
   <head>
      <style type="text/css">
         .sikuli-code {
            font-size: 20px;
            font-family: "Osaka-mono", Monospace;
            line-height: 1.5em;
            display:table-cell;
            white-space: pre-wrap;       /* css-3 */
            white-space: -moz-pre-wrap !important;  /* Mozilla, since 1999 */
            white-space: -pre-wrap;      /* Opera 4-6 */
            white-space: -o-pre-wrap;    /* Opera 7 */
            word-wrap: break-word;       /* Internet Explorer 5.5+ */
            width: 99%;   /* remove horizontal scroll-bar when viewing in IE7 */
         }
         .sikuli-code img {
            vertical-align: middle;
            margin: 2px;
            border: 1px solid #ccc;
            padding: 2px;
            -moz-border-radius: 5px;
            -webkit-border-radius: 5px;
            -moz-box-shadow: 1px 1px 1px gray;
            -webkit-box-shadow: 1px 1px 2px gray;
         }
         .kw {
            color: blue;
         }
         .skw {
            color: rgb(63, 127, 127);
         }

         .str {
            color: rgb(128, 0, 0);
         }

         .dig {
            color: rgb(128, 64, 0);
         }

         .cmt {
            color: rgb(200, 0, 200);
         }

         h2 {
            display: inline;
            font-weight: normal;
         }

         .info {
            border-bottom: 1px solid #ddd;
            padding-bottom: 5px;
            margin-bottom: 20px;
            display: none;
         }

         a {
            color: #9D2900;
         }

         body {
            font-family: "Trebuchet MS", Arial, Sans-Serif;
         }

      </style>
   </head>
<body>
<div class="info">
<h2>legendQLib.sikuli</h2> <a href="legendQLib.zip">(Download this script)</a>
</div>
<pre class="sikuli-code">
<span class="kw">from</span> sikuli <span class="kw">import</span> *

<span class="cmt"># check region image is exists and click
</span><span class="kw">def</span> checkClick(obj):
    <span class="kw">if</span> exists(obj):
        <span class="skw">click</span>(obj)

<span class="cmt"># wait region image and click
</span><span class="kw">def</span> waitAndClick(obj, sec):
    <span class="skw">wait</span>(obj, sec)
    <span class="skw">click</span>(obj)

<span class="cmt"># create game for first B studenet
</span><span class="kw">def</span> createGame(firstStudent):
    <span class="kw">print</span>(<span class="str">'create game...'</span>)
    checkClick(<img src="1380695415869-1.png" />)

    <span class="kw">print</span>(<span class="str">'select first student...'</span>)
    <span class="skw">wait</span>(<img src="1380695482077-1.png" />, <span class="dig">30</span>)
    checkClick(firstStudent)
    checkClick(<img src="1380695515823-1.png" />)

<span class="cmt"># run tutorial and expect Ace student
</span><span class="kw">def</span> runTutorial(firstAce):
    <span class="skw">wait</span>(<img src="1380695640309-3.png" />, <span class="dig">10</span>)
    <span class="skw">click</span>(<img src="1380724384033.png" />)
    <span class="skw">click</span>(<img src="1380695762060-3.png" />)
    <span class="skw">wait</span>(<img src="1380695815218-3.png" />, <span class="dig">30</span>)
    <span class="skw">click</span>(<img src="1380695830359-3.png" />)
    <span class="skw">click</span>(<img src="1380695864981-3.png" />)
    <span class="skw">wait</span>(<span class="dig">2</span>)

    stud = pickStudent(<span class="dig">0</span>, firstAce)
    <span class="kw">print</span>(<span class="str">"stud: %s"</span> % stud)
    b = <span class="dig">0</span>
    <span class="kw">if</span> stud &gt;= <span class="dig">4</span>:
        b = <span class="dig">1</span>
    <span class="skw">click</span>(<img src="1380696105210-3.png" />)
    <span class="skw">click</span>(<img src="1380696128810-3.png" />)
    <span class="skw">click</span>(<img src="1380696149010-3.png" />)
    <span class="skw">click</span>(<img src="1380695864981-3.png" />)
    <span class="skw">click</span>(<img src="1380724384033-1.png" />)
    <span class="skw">click</span>(<img src="1380695762060-3.png" />)
    <span class="skw">wait</span>(<img src="1380696450966-3.png" />, <span class="dig">20</span>)
    <span class="skw">click</span>(<img src="1380695830359-3.png" />)
    <span class="skw">click</span>(<img src="1380696510493-3.png" />)
    <span class="skw">click</span>(<img src="1380695864981-3.png" />)
    waitAndClick(<img src="1380696677065-3.png" />, <span class="dig">10</span>)
    <span class="skw">click</span>(<img src="1380696735878-3.png" />)
    <span class="skw">click</span>(<img src="1380696829107-3.png" />)
    <span class="skw">click</span>(<img src="1380696853984-3.png" />)
    <span class="skw">click</span>(<img src="1380695864981-3.png" />)
    <span class="skw">click</span>(<img src="1380696903585-3.png" />)
    <span class="skw">click</span>(<img src="1380696921992-3.png" />)
    <span class="skw">wait</span>(<span class="dig">2</span>)
    <span class="skw">wait</span>(<img src="1380696939217-3.png" />)
    <span class="skw">click</span>(<img src="1380696939217-3.png" />)
    <span class="skw">wait</span>(<span class="dig">2</span>)
    <span class="skw">click</span>(<img src="1380695864981-3.png" />)
    <span class="skw">click</span>(<img src="1380724384033-2.png" />)
    <span class="skw">click</span>(<img src="1380697007266-3.png" />)
    <span class="skw">wait</span>(<img src="1380695830359-3.png" />, <span class="dig">30</span>)
    <span class="skw">click</span>(<img src="1380695830359-3.png" />)
    <span class="cmt"># level up
</span>    <span class="kw">print</span>(<span class="str">"level up..."</span>)
    <span class="skw">wait</span>(<img src="1380702038600-1.png" />, <span class="dig">5</span>)
    <span class="skw">click</span>(<img src="1380702038600-1.png" />)

    <span class="kw">print</span>(<span class="str">"check drop item..."</span>)
    <span class="kw">if</span> exists(<img src="1380695515823-3.png" />):
        <span class="skw">click</span>(<img src="1380695515823-3.png" />)
    <span class="kw">print</span>(<span class="str">"close"</span>)
    <span class="kw">if</span> exists(<img src="1380696510493-2.png" />):
        <span class="skw">click</span>(<img src="1380696510493-2.png" />)
    closeSuprise()
    <span class="skw">click</span>(<img src="1380695864981-3.png" />)
    <span class="kw">return</span> b

<span class="cmt"># go to reset account
</span><span class="kw">def</span> gotoreset():
    <span class="skw">click</span>(<img src="1380697566803.png" />)
    <span class="skw">wait</span>(<span class="dig">2</span>)
    <span class="skw">click</span>(<img src="1380697586833.png" />)
    reset(<span class="dig">0</span>, <span class="dig">0</span>)
    <span class="cmt">#click("1380697620865.png")
</span>    <span class="cmt"># 文字辨試輸入
</span>
<span class="kw">def</span> leftRegion():
    <span class="kw">return</span> Region(myRegion.getX(), myRegion.getY(), myRegion.getW() / <span class="dig">2</span>, myRegion.getH())

<span class="kw">def</span> rightUpRegion():
    <span class="kw">return</span> Region(myRegion.getX() + (myRegion.getW() / <span class="dig">2</span>), myRegion.getY(), myRegion.getW() / <span class="dig">2</span>, myRegion.getH()/<span class="dig">2</span>)

<span class="cmt"># reset account
</span><span class="kw">def</span> reset(a, b):
    tread = Settings.OcrTextRead
    Settings.OcrTextRead = True

    regLeft = <span class="skw">find</span>(<img src="1380292721591.png" />)
    regRight = <span class="skw">find</span>(<img src="1380292736191.png" />)
    newX = regLeft.getX() + regLeft.getW()
    textReg = Region(newX, regLeft.getY(), regRight.getX() - newX, regLeft.getH())
    <span class="kw">print</span>(<span class="str">"%s, %s, %s, %s "</span> % (textReg.getX(), textReg.getY(), textReg.getW(), textReg.getH()) )
    s = textReg.text()
    <span class="kw">print</span>(<span class="str">'origin s:%s'</span> % (s))
    s1 = s.replace(<span class="str">"."</span>,<span class="str">""</span>)
    s2 = s1.replace(<span class="str">" "</span>,<span class="str">""</span>)
    s3 = filter(onlyascii, s2)
    <span class="kw">print</span>(<span class="str">'s:%s, s1:%s, s2:%s, s3:%s'</span> % (s, s1, s2, s3))
    <span class="skw">click</span>(<img src="1380293789145.png" />)
    <span class="skw">wait</span>(<span class="dig">3</span>)
    <span class="skw">type</span>(s3)
    <span class="skw">wait</span>(<span class="dig">3</span>)
    <span class="skw">type</span>(<span class="str">"\r"</span>)

    Settings.OcrTextRead = tread

    <span class="skw">wait</span>(<img src="1380294123754.png" />)
    <span class="skw">click</span>(<img src="1380294123754.png" />)

    <span class="skw">wait</span>(<span class="dig">5</span>)
    <span class="kw">if</span> exists(<img src="1380294123754.png" />):
        returnTopMenu()
        gotoreset()


<span class="kw">def</span> onlyascii(char):
    <span class="kw">if</span> ord(char) &lt; <span class="dig">48</span> <span class="kw">or</span> ord(char) &gt; <span class="dig">127</span>: <span class="kw">return</span> <span class="str">''</span>
    <span class="kw">else</span>: <span class="kw">return</span> char

<span class="cmt"># pick student
</span><span class="cmt"># param flag: student type | 0 Ace, 1 B, 2 C,D
</span><span class="cmt"># param obj: expect role
</span><span class="cmt"># return: expect result bitmask: 0-note expected, 4-expected ; student type bitmask 0-A, 1-B, 2-C, 3-D 
</span><span class="kw">def</span> pickStudent(flag, obj):
    <span class="skw">click</span>(<img src="1380720199487.png" />)
    <span class="kw">if</span> flag == <span class="dig">0</span>:
        <span class="skw">wait</span>(Pattern(<img src="1380710775636-1.png" />).similar(<span class="dig">0.95</span>), <span class="dig">10</span>)
        <span class="skw">click</span>(Pattern(<img src="1380710775636-1.png" />).similar(<span class="dig">0.95</span>))
    <span class="kw">elif</span> flag == <span class="dig">1</span>:
        <span class="skw">wait</span>(Pattern(<img src="1380720222877.png" />).similar(<span class="dig">0.95</span>), <span class="dig">10</span>)
        <span class="skw">click</span>(Pattern(<img src="1380720222877.png" />).similar(<span class="dig">0.95</span>))
    <span class="cmt">#else:
</span>
    <span class="skw">wait</span>(<span class="dig">3</span>);

    lv = <span class="dig">0</span>
    <span class="kw">if</span> exists(<img src="1380721537747.png" />):
        lv = <span class="dig">0</span>
    <span class="kw">elif</span> exists(<img src="1380721548302.png" />):
        lv = <span class="dig">1</span>
    <span class="kw">else</span>:
        lv = <span class="dig">2</span>

    foundObj = <span class="dig">0</span>
    <span class="kw">if</span> obj != <span class="dig">0</span> <span class="kw">and</span> exists(obj):
        foundObj = <span class="dig">4</span>
    ret = lv + foundObj
    <span class="kw">print</span>(<span class="str">"pick ret: %s "</span> % ret)
    <span class="skw">wait</span>(<img src="1380695974966-3.png" />, <span class="dig">20</span>)
    <span class="skw">click</span>(<img src="1380695974966-3.png" />)
    returnTopMenu()
    <span class="kw">return</span> ret

<span class="cmt"># back to top menu
</span><span class="kw">def</span> returnTopMenu():
    <span class="kw">while</span> exists(<img src="1380725442905.png" />):
        <span class="skw">click</span>(<img src="1380725442905.png" />)
        <span class="skw">wait</span>(<span class="dig">1</span>)
    <span class="kw">if</span> exists(<img src="1380695864981-3.png" />):
        <span class="skw">click</span>(<img src="1380695864981-3.png" />)
        <span class="skw">wait</span>(<span class="dig">1</span>)
        returnTopMenu()

<span class="kw">def</span> closeSuprise():
     <span class="kw">while</span> exists(<img src="1380743092036.png" />, <span class="dig">2</span>):
        <span class="skw">click</span>(<img src="1380743092036.png" />)
        <span class="skw">wait</span>(<span class="dig">1</span>)


<span class="kw">def</span> skipBattle():
    <span class="kw">print</span>(<span class="str">"skipBattle..."</span>)
    <span class="kw">if</span> exists(<img src="1380782430341.png" />, <span class="dig">20</span>):
        <span class="skw">click</span>(<img src="1380782430341.png" />)
        <span class="kw">if</span> exists(<img src="1380782771931.png" />, <span class="dig">20</span>):
            <span class="skw">click</span>(<img src="1380782771931.png" />)



<span class="kw">def</span> upToLv5AndGetGold():
    <span class="skw">click</span>(<img src="1380724384033-3.png" />)
    waitAndClick(<img src="1380740029234.png" />, <span class="dig">10</span>)
    <span class="skw">wait</span>(<span class="dig">1</span>)
    lv = <span class="dig">2</span>
    <span class="cmt"># loop to lv 5
</span>    <span class="kw">while</span> <span class="dig">1</span>:
        <span class="skw">click</span>(<img src="1380740063563.png" />)
        skipBattle()
        waitAndClick(<img src="1380695830359-2.png" />, <span class="dig">30</span>)
        <span class="skw">wait</span>(<span class="dig">1</span>)
        <span class="kw">if</span> exists(<img src="1380740401525.png" />):
            lv += <span class="dig">1</span>
            closeSuprise()
            <span class="kw">if</span> exists(<img src="1380745900232.png" />):
                <span class="skw">click</span>(<img src="1380745900232.png" />)

        <span class="kw">print</span>(<span class="str">"lv: %s"</span> % lv)

        closeSuprise()

        <span class="kw">if</span> lv == <span class="dig">5</span>:
            <span class="kw">break</span>

    returnTopMenu()
    <span class="cmt"># get Gold
</span>    waitAndClick(<img src="1380741089704.png" />, <span class="dig">10</span>)
    waitAndClick(<img src="1380741161878.png" />, <span class="dig">10</span>)
    waitAndClick(<img src="1380741198664.png" />, <span class="dig">3</span>)
    waitAndClick(<img src="1380741260901.png" />, <span class="dig">5</span>)
    <span class="skw">click</span>(<img src="1380741221220.png" />)
    returnTopMenu()
    waitAndClick(<img src="1380741338550.png" />, <span class="dig">5</span>)
    waitAndClick(<img src="1380741380684.png" />, <span class="dig">5</span>)
    waitAndClick(<img src="1380741413769.png" />, <span class="dig">5</span>)
    returnTopMenu()

<span class="cmt"># test entry
</span><span class="kw">def</span> testMain():
    openApp(<span class="str">"BlueStacks"</span>)
    upToLv5AndGetGold()

testMain()
</pre>
</body>
</html>
