
<html>
   <head>
      <style type="text/css">
         .sikuli-code {
            font-size: 20px;
            font-family: "Osaka-mono", Monospace;
            line-height: 1.5em;
            display:table-cell;
            white-space: pre-wrap;       /* css-3 */
            white-space: -moz-pre-wrap !important;  /* Mozilla, since 1999 */
            white-space: -pre-wrap;      /* Opera 4-6 */
            white-space: -o-pre-wrap;    /* Opera 7 */
            word-wrap: break-word;       /* Internet Explorer 5.5+ */
            width: 99%;   /* remove horizontal scroll-bar when viewing in IE7 */
         }
         .sikuli-code img {
            vertical-align: middle;
            margin: 2px;
            border: 1px solid #ccc;
            padding: 2px;
            -moz-border-radius: 5px;
            -webkit-border-radius: 5px;
            -moz-box-shadow: 1px 1px 1px gray;
            -webkit-box-shadow: 1px 1px 2px gray;
         }
         .kw {
            color: blue;
         }
         .skw {
            color: rgb(63, 127, 127);
         }

         .str {
            color: rgb(128, 0, 0);
         }

         .dig {
            color: rgb(128, 64, 0);
         }

         .cmt {
            color: rgb(200, 0, 200);
         }

         h2 {
            display: inline;
            font-weight: normal;
         }

         .info {
            border-bottom: 1px solid #ddd;
            padding-bottom: 5px;
            margin-bottom: 20px;
            display: none;
         }

         a {
            color: #9D2900;
         }

         body {
            font-family: "Trebuchet MS", Arial, Sans-Serif;
         }

      </style>
   </head>
<body>
<div class="info">
<h2>legendQLib.sikuli</h2> <a href="legendQLib.zip">(Download this script)</a>
</div>
<pre class="sikuli-code">
<span class="kw">from</span> sikuli <span class="kw">import</span> *

<span class="cmt"># ActionMethodWithRegion
</span><span class="cmt"># param region: In this given region, find and click the pattern in 30 sec.
</span><span class="cmt"># param pattern: The target you want to click, which could be a string, pic or something else.
</span><span class="cmt"># return: null
</span><span class="kw">def</span> ActionMethodWithRegion(region, pattern):
    region.<span class="skw">wait</span>(pattern, <span class="dig">30</span>)
    region.<span class="skw">click</span>(pattern)
    <span class="kw">return</span>

<span class="cmt"># ActionMethod
</span><span class="cmt"># If myRegion exists, invoke ActionMethodWithRegion(myRegion, pattern)
</span><span class="cmt"># param pattern: The target you want to click, which could be a string, pic or something else.
</span><span class="cmt"># return: null
</span><span class="kw">def</span> ActionMethod(pattern):
    ActionMethodWithRegion(myRegion, pattern)
    <span class="kw">return</span>

<span class="cmt"># Log
</span><span class="cmt"># For any textEditor you assign, type the log into.
</span><span class="cmt"># param s: 
</span><span class="cmt"># return: null
</span><span class="kw">def</span> Log(s):
    <span class="kw">if</span> myText:
        <span class="skw">wait</span>(<span class="dig">1</span>)
        myText.focus()
        <span class="skw">wait</span>(<span class="dig">1</span>)
        <span class="skw">type</span>(s)
        <span class="skw">wait</span>(<span class="dig">1</span>)
        myApp.focus()
        <span class="skw">wait</span>(<span class="dig">1</span>)
    <span class="kw">else</span>:
        <span class="kw">print</span>(s)
    <span class="kw">return</span>

<span class="kw">def</span> closeSuprise():
    <span class="kw">while</span> exists(<img src="1380743092036.png" />):
        <span class="skw">click</span>(<img src="1380743092036.png" />)
        <span class="skw">wait</span>(<span class="dig">1</span>)

<span class="cmt"># check region image is exists and click
</span><span class="kw">def</span> checkClick(obj):
    <span class="kw">if</span> exists(obj):
        <span class="skw">click</span>(obj)

<span class="cmt"># wait region image and click
</span><span class="kw">def</span> waitAndClick(obj, sec):
    <span class="skw">wait</span>(obj, sec)
    <span class="skw">click</span>(obj)

<span class="cmt"># create game for first B studenet
</span><span class="kw">def</span> createGame(firstStudent):
    <span class="kw">print</span>(<span class="str">'create game...'</span>)
    checkClick(<img src="1380695415869-1.png" />)

    <span class="kw">print</span>(<span class="str">'select first student...'</span>)
    <span class="skw">wait</span>(<img src="1380695482077-1.png" />, <span class="dig">30</span>)
    checkClick(firstStudent)
    checkClick(<img src="1380695515823-1.png" />)

<span class="cmt"># run tutorial and expect Ace student
</span><span class="kw">def</span> runTutorial(firstAce):
    <span class="skw">wait</span>(<img src="1380695640309-3.png" />, <span class="dig">10</span>)
    <span class="skw">click</span>(<img src="1380724384033.png" />)
    <span class="skw">click</span>(<img src="1380695762060-3.png" />)
    <span class="skw">wait</span>(<img src="1380695815218-3.png" />, <span class="dig">30</span>)
    <span class="skw">click</span>(<img src="1380695830359-3.png" />)
    <span class="skw">click</span>(<img src="1380695864981-3.png" />)
    <span class="skw">wait</span>(<span class="dig">2</span>)

    stud = pickStudent(<span class="dig">0</span>, firstAce)
    <span class="kw">print</span>(<span class="str">"stud: %s"</span> % stud)
    b = <span class="dig">0</span>
    <span class="kw">if</span> stud &gt;= <span class="dig">4</span>:
        b = <span class="dig">1</span>
    <span class="skw">click</span>(<img src="1380696105210-3.png" />)
    <span class="skw">click</span>(<img src="1380696128810-3.png" />)
    <span class="skw">click</span>(<img src="1380696149010-3.png" />)
    <span class="skw">click</span>(<img src="1380695864981-3.png" />)
    <span class="skw">click</span>(<img src="1380724384033-1.png" />)
    <span class="skw">click</span>(<img src="1380695762060-3.png" />)
    <span class="skw">wait</span>(<img src="1380696450966-3.png" />, <span class="dig">20</span>)
    <span class="skw">click</span>(<img src="1380695830359-3.png" />)
    <span class="skw">click</span>(<img src="1380696510493-3.png" />)
    <span class="skw">click</span>(<img src="1380695864981-3.png" />)
    waitAndClick(<img src="1380696677065-3.png" />, <span class="dig">10</span>)
    <span class="skw">click</span>(Pattern(<img src="1380784407298.png" />).similar(<span class="dig">0.90</span>))
    <span class="skw">click</span>(<img src="1380696829107-3.png" />)
    <span class="skw">click</span>(<img src="1380696853984-3.png" />)
    <span class="skw">click</span>(<img src="1380695864981-3.png" />)
    <span class="skw">click</span>(<img src="1380696903585-3.png" />)
    <span class="skw">click</span>(<img src="1380696921992-3.png" />)
    <span class="skw">wait</span>(<span class="dig">2</span>)
    <span class="skw">wait</span>(<img src="1380696939217-3.png" />)
    <span class="skw">click</span>(<img src="1380696939217-3.png" />)
    <span class="skw">wait</span>(<span class="dig">2</span>)
    <span class="skw">click</span>(<img src="1380695864981-3.png" />)
    <span class="skw">click</span>(<img src="1380724384033-2.png" />)
    <span class="skw">click</span>(<img src="1380697007266-3.png" />)
    <span class="skw">wait</span>(<img src="1380695830359-3.png" />, <span class="dig">30</span>)
    <span class="skw">click</span>(<img src="1380695830359-3.png" />)
    <span class="cmt"># level up
</span>    <span class="kw">print</span>(<span class="str">"level up..."</span>)
    <span class="skw">wait</span>(<img src="1380702038600-1.png" />, <span class="dig">5</span>)
    <span class="skw">click</span>(<img src="1380702038600-1.png" />)

    <span class="kw">print</span>(<span class="str">"check drop item..."</span>)
    <span class="kw">if</span> exists(<img src="1380695515823-3.png" />):
        <span class="skw">click</span>(<img src="1380695515823-3.png" />)
    <span class="kw">print</span>(<span class="str">"close"</span>)
    <span class="kw">if</span> exists(<img src="1380696510493-2.png" />):
        <span class="skw">click</span>(<img src="1380696510493-2.png" />)
    closeSuprise()
    <span class="skw">click</span>(<img src="1380695864981-3.png" />)
    <span class="kw">return</span> b

<span class="cmt"># gotoreset
</span><span class="cmt"># reset the account. Note, you have to invoke returnTopMenu before this method, for be suring that we could go from setting options.
</span><span class="cmt"># return: null
</span><span class="kw">def</span> gotoreset():
    ActionMethod(<img src="1380297823894.png" />)
    ActionMethod(<img src="1380297843385.png" />)
    myRegion.<span class="skw">wait</span>(<span class="dig">3</span>)
    reset(<img src="1380292721591.png" />, <img src="1380292736191.png" />)
    myRegion.<span class="skw">wait</span>(<span class="dig">3</span>)
    resetFailCondition()
    <span class="kw">return</span>


<span class="cmt"># leftRegion
</span><span class="cmt"># The left screen of myRegion. To decrease the searching area for finding patterns.
</span><span class="cmt"># return: null
</span><span class="kw">def</span> leftRegion():
    <span class="kw">return</span> Region(myRegion.getX(), myRegion.getY(), myRegion.getW() / <span class="dig">2</span>, myRegion.getH())

<span class="cmt"># rightUpRegion
</span><span class="cmt"># one-fouth of myRegion in RightUp side. For decreasing the searching area.
</span><span class="cmt"># return: null
</span><span class="kw">def</span> rightUpRegion():
    <span class="kw">return</span> Region(myRegion.getX() + (myRegion.getW() / <span class="dig">2</span>), myRegion.getY(), myRegion.getW() / <span class="dig">2</span>, myRegion.getH()/<span class="dig">2</span>)

<span class="cmt">#OCR method
</span><span class="cmt">#param leftOfOCR: the picture which is left from OCR.
</span><span class="cmt">#param rightOfOCR: the picture which is right from OCR
</span><span class="cmt">#return: the OCR string in ASCII
</span><span class="kw">def</span> OCR(leftOfOCR, rightOfOCR):
    regLeft = myRegion.<span class="skw">find</span>(leftOfOCR)
    regRight = myRegion.<span class="skw">find</span>(rightOfOCR)
    newX = regLeft.getX() + regLeft.getW()
    textReg = Region(newX, regLeft.getY(), regRight.getX() - newX, regLeft.getH())
    s = textReg.text()
    <span class="kw">print</span>(<span class="str">'origin s:%s'</span> % (s))
    s1 = s.replace(<span class="str">"."</span>,<span class="str">""</span>)
    s2 = s1.replace(<span class="str">" "</span>,<span class="str">""</span>)
    s3 = filter(onlyascii, s2)
    <span class="kw">print</span> (<span class="str">'after proofread: %s'</span> % s3)

    <span class="kw">return</span> s3

<span class="cmt"># fillRegCode
</span><span class="cmt"># filling the regCode while reset the account.
</span><span class="cmt"># param s: OCR string
</span><span class="cmt"># return: null
</span><span class="kw">def</span> fillRegCode(s):
    myRegion.<span class="skw">click</span>(<img src="1380293789145-1.png" />)
    myRegion.<span class="skw">wait</span>(<span class="dig">3</span>)
    myRegion.<span class="skw">type</span>(s)
    myRegion.<span class="skw">wait</span>(<span class="dig">3</span>)
    <span class="skw">type</span>(<span class="str">"\n"</span>)
    ActionMethod(<img src="1380294123754-1.png" />)
    <span class="kw">return</span>

<span class="cmt"># reset
</span><span class="cmt"># reset this account in typing regCode screen.
</span><span class="cmt"># param leftOfOCR: the left picture of OCR
</span><span class="cmt"># param leftOfOCR: The right picture of OCR
</span><span class="cmt"># return: null
</span><span class="kw">def</span> reset(leftOfOCR, rightOfOCR):
    tread = Settings.OcrTextRead
    Settings.OcrTextRead = True
    s = OCR(leftOfOCR, rightOfOCR)
    fillRegCode(s)
    resetFailCondition()
    <span class="kw">return</span>

<span class="cmt"># onlyascii
</span><span class="cmt"># trim the string to exclude any non-ASCII char.
</span><span class="cmt"># param char: Any string you want to process
</span><span class="cmt"># return: A string excluding non-ASCII char
</span><span class="kw">def</span> onlyascii(char):
    <span class="kw">if</span> ord(char) &lt; <span class="dig">48</span> <span class="kw">or</span> ord(char) &gt; <span class="dig">127</span>: <span class="kw">return</span> <span class="str">''</span>
    <span class="kw">else</span>: <span class="kw">return</span> char

<span class="cmt"># resetFailCondition
</span><span class="cmt"># In the failure condition of reseting account, you should invoke this method to try again.
</span><span class="cmt"># return: null
</span><span class="kw">def</span> resetFailCondition():
    <span class="kw">if</span> myRegion.exists(<img src="1380298064898.png" />,<span class="dig">10</span>) == None:
        returnTopMenu()
        gotoReset()
    <span class="kw">return</span>

<span class="cmt"># returnTopMenu
</span><span class="cmt"># disable all window until the main screen is visible
</span><span class="cmt"># param char: Any string you want to process
</span><span class="cmt"># return: A string excluding non-ASCII char
</span><span class="kw">def</span> returnTopMenu():
    <span class="kw">while</span> myRegion.exists(<img src="1380302243814.png" />) == None:

        <span class="kw">if</span> clickXToBack(myRegion):
            myRegion.<span class="skw">wait</span>(<span class="dig">3</span>)
            <span class="kw">continue</span>
        <span class="kw">else</span>:
            <span class="kw">break</span>
    myRegion.<span class="skw">wait</span>(<span class="dig">1</span>)
    <span class="kw">return</span>

<span class="cmt"># clickXToBack
</span><span class="cmt"># click the X button. If the number of X button is bigger then 1, this methomd would click the x-button whose x position is the minimum of them.
</span><span class="cmt"># param appRegion: searching region
</span><span class="cmt"># return: null
</span>
<span class="kw">def</span> clickXToBack(appRegion):
    <span class="kw">while</span> True:
        rValue = False
        x1 = []
        x2 = []
        allArray = []
        targetRegion =  rightUpRegion()
        <span class="kw">if</span> targetRegion.exists(<img src="1380553164626.png" />):
            x1 = targetRegion.findAll(<img src="1380553164626.png" />)
            allArray += x1
        <span class="kw">if</span> targetRegion.exists(<img src="1380341000249.png" />):
            x2 = targetRegion.findAll(<img src="1380341000249.png" />)
            allArray += x2
        <span class="kw">if</span> <span class="kw">not</span> allArray:
            <span class="kw">return</span> rValue
        rValue = True
        newList = sorted(allArray, key=<span class="kw">lambda</span> obj: obj.getX())
        total = len(list(newList))
        targetRegion.<span class="skw">click</span>(newList[<span class="dig">0</span>])
        targetRegion.<span class="skw">wait</span>(<span class="dig">3</span>)
    <span class="kw">return</span> rValue

<span class="cmt"># pick student
</span><span class="cmt"># param flag: student type | 0 Ace, 1 B, 2 C,D
</span><span class="cmt"># param obj: expect role
</span><span class="cmt"># return: expect result bitmask: 0-note expected, 4-expected ; student type bitmask 0-A, 1-B, 2-C, 3-D 
</span><span class="kw">def</span> pickStudent(flag, obj):
    <span class="skw">click</span>(<img src="1380720199487.png" />)
    <span class="kw">if</span> flag == <span class="dig">0</span>:
        <span class="skw">wait</span>(Pattern(<img src="1380710775636-1.png" />).similar(<span class="dig">0.95</span>), <span class="dig">10</span>)
        <span class="skw">click</span>(Pattern(<img src="1380710775636-1.png" />).similar(<span class="dig">0.95</span>))
    <span class="kw">elif</span> flag == <span class="dig">1</span>:
        <span class="skw">wait</span>(Pattern(<img src="1380720222877.png" />).similar(<span class="dig">0.95</span>), <span class="dig">10</span>)
        <span class="skw">click</span>(Pattern(<img src="1380720222877.png" />).similar(<span class="dig">0.95</span>))
    <span class="cmt">#else:
</span>
    <span class="skw">wait</span>(<span class="dig">3</span>);

    lv = <span class="dig">0</span>
    <span class="kw">if</span> exists(<img src="1380721537747.png" />):
        lv = <span class="dig">0</span>
    <span class="kw">elif</span> exists(<img src="1380721548302.png" />):
        lv = <span class="dig">1</span>
    <span class="kw">else</span>:
        lv = <span class="dig">2</span>

    foundObj = <span class="dig">0</span>
    <span class="kw">if</span> obj != <span class="dig">0</span> <span class="kw">and</span> exists(obj):
        foundObj = <span class="dig">4</span>
    ret = lv + foundObj
    <span class="kw">print</span>(<span class="str">"pick ret: %s "</span> % ret)
    <span class="skw">wait</span>(<img src="1380695974966-3.png" />, <span class="dig">20</span>)
    <span class="skw">click</span>(<img src="1380695974966-3.png" />)
    returnTopMenu()
    <span class="kw">return</span> ret


<span class="kw">def</span> closeSuprise():
     <span class="kw">while</span> exists(<img src="1380553164626.png" />, <span class="dig">2</span>):
        <span class="skw">click</span>(<img src="1380553164626.png" />)
        <span class="skw">wait</span>(<span class="dig">1</span>)

<span class="kw">def</span> skipBattle():
    <span class="kw">print</span>(<span class="str">"skipBattle..."</span>)
    <span class="kw">if</span> exists(<img src="1380782430341.png" />, <span class="dig">20</span>):
        <span class="skw">click</span>(<img src="1380782430341.png" />)
        <span class="kw">if</span> exists(<img src="1380782771931.png" />, <span class="dig">20</span>):
            <span class="skw">click</span>(<img src="1380782771931.png" />)



<span class="kw">def</span> upToLv5AndGetGold():
    <span class="skw">click</span>(<img src="1380724384033-3.png" />)
    waitAndClick(<img src="1380740029234.png" />, <span class="dig">10</span>)
    <span class="skw">wait</span>(<span class="dig">1</span>)
    lv = <span class="dig">2</span>
    <span class="cmt"># loop to lv 5
</span>    <span class="kw">while</span> <span class="dig">1</span>:
        <span class="skw">click</span>(<img src="1380740063563.png" />)
        skipBattle()
        waitAndClick(<img src="1380695830359-2.png" />, <span class="dig">30</span>)
        <span class="skw">wait</span>(<span class="dig">1</span>)
        <span class="kw">if</span> exists(<img src="1380740401525.png" />):
            lv += <span class="dig">1</span>
            closeSuprise()
            <span class="kw">if</span> exists(<img src="1380745900232.png" />):
                <span class="skw">click</span>(<img src="1380745900232.png" />)

        <span class="kw">print</span>(<span class="str">"lv: %s"</span> % lv)

        closeSuprise()

        <span class="kw">if</span> lv == <span class="dig">5</span>:
            <span class="kw">break</span>

    returnTopMenu()
    <span class="cmt"># get Gold
</span>    waitAndClick(<img src="1380741089704.png" />, <span class="dig">10</span>)
    waitAndClick(<img src="1380741161878.png" />, <span class="dig">10</span>)
    waitAndClick(<img src="1380741198664.png" />, <span class="dig">3</span>)
    waitAndClick(<img src="1380741260901.png" />, <span class="dig">5</span>)
    <span class="skw">click</span>(<img src="1380741221220.png" />)
    returnTopMenu()
    waitAndClick(<img src="1380741338550.png" />, <span class="dig">5</span>)
    waitAndClick(<img src="1380741380684.png" />, <span class="dig">5</span>)
    waitAndClick(<img src="1380741413769.png" />, <span class="dig">5</span>)
    returnTopMenu()


<span class="kw">def</span> protectChildElder(times):
    <span class="skw">click</span>(Pattern(<img src="1380806541739.png" />).similar(<span class="dig">0.80</span>))
    waitAndClick(<img src="1380806832421.png" />, <span class="dig">10</span>)
    <span class="cmt"># loop
</span>    <span class="kw">for</span> i <span class="kw">in</span> range(times):
        waitAndClick(<img src="1380806695283.png" />, <span class="dig">4200</span>)
        skipBattle()
        waitAndClick(<img src="1380695830359-2.png" />, <span class="dig">300</span>)
        waitAndClick(<img src="1380806808028.png" />, <span class="dig">10</span>)
        closeSuprise()


<span class="cmt"># test entry
</span><span class="kw">def</span> testMain():
    openApp(<span class="str">"BlueStacks"</span>)
    <span class="cmt">#upToLv5AndGetGold()
</span>    <span class="cmt">#protectChildElder(8)
</span>    <span class="kw">print</span>(<span class="str">"abv"</span>)


testMain()
</pre>
</body>
</html>
